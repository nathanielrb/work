<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>mu.semte.ch Elasticsearch Module</title>
<!-- 2019-02-13 mer. 18:21 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="type" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../org.css"/>

<script type="text/javascript" src="http://orgmode.org/org-info.js">
/**
 *
 * @source: http://orgmode.org/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in http://orgmode.org/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in http://orgmode.org/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "4");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "0");
org_html_manager.set("VIEW", "content");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">mu.semte.ch Elasticsearch Module</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Questions</a>
<ul>
<li><a href="#sec-1-1">Auth model, once and for all</a></li>
<li><a href="#sec-1-2">how to specify eager-indexing groups by sparql query?</a></li>
<li><a href="#sec-1-3">Specify 'eager indexing from the semantic model'</a></li>
</ul>
</li>
<li><a href="#sec-2">Features</a>
<ul>
<li><a href="#sec-2-1">Environment</a>
<ul>
<li><a href="#sec-2-1-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></a></li>
<li><a href="#sec-2-1-2"><span class="todo TODO">TODO</span> Wait until Elasticsearch is loaded before loading</a></li>
</ul>
</li>
<li><a href="#sec-2-2">Configuration language</a>
<ul>
<li><a href="#sec-2-2-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></a>
<ul>
<li><a href="#sec-2-2-1-1">Construct configuration language</a></li>
</ul>
</li>
<li><a href="#sec-2-2-2"><span class="done DONE">DONE</span> Allow lists of predicates for property paths&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-2-3">Architecture</a>
<ul>
<li><a href="#sec-2-3-1">Harmonize naming&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-2-4">Indexing</a>
<ul>
<li><a href="#sec-2-4-1"><span class="done DONE">DONE</span> Construct the index endpoint</a></li>
<li><a href="#sec-2-4-2"><span class="done DONE">DONE</span> Indexing endpoint for all cases</a></li>
<li><a href="#sec-2-4-3"><span class="done DONE">DONE</span> Batch-process indexing</a></li>
<li><a href="#sec-2-4-4">Multithreading and blocking&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a>
<ul>
<li><a href="#sec-2-4-4-1"><span class="done DONE">DONE</span> Block simultaneous queries on new/invalid index</a></li>
<li><a href="#sec-2-4-4-2">Queue and/or block multiple updates from deltas</a></li>
<li><a href="#sec-2-4-4-3"><span class="todo TODO">TODO</span> What about new invalidation in the middle of updating?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="question">question</span></span></a></li>
</ul>
</li>
<li><a href="#sec-2-4-5"><span class="done DONE">DONE</span> On initial indexing, wait before count query&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-4-6">Correct use of application graph&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span>&#xa0;<span class="fix">fix</span></span></a></li>
<li><a href="#sec-2-4-7"><span class="done DONE">DONE</span> Endpoints for resetting, invalidation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a>
<ul>
<li><a href="#sec-2-4-7-1"><span class="done DONE">DONE</span> index all indexes (per type), w/o auth_groups</a></li>
<li><a href="#sec-2-4-7-2"><span class="done DONE">DONE</span> invalidate</a></li>
</ul>
</li>
<li><a href="#sec-2-4-8"><span class="done DONE">DONE</span> /index endpoint should delete all docs before indexing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-2-5">Access Rights</a>
<ul>
<li><a href="#sec-2-5-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></a></li>
<li><a href="#sec-2-5-2">Basic access rights storage and lookup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a>
<ul>
<li><a href="#sec-2-5-2-1"><span class="done DONE">DONE</span> Store and lookup indexes in memory</a></li>
<li><a href="#sec-2-5-2-2"><span class="done DONE">DONE</span> Serialize to triplestore and load at boot-up.</a></li>
<li><a href="#sec-2-5-2-3"><span class="done DONE">DONE</span> Finalize vocabulary for storing in triple-store</a></li>
<li><a href="#sec-2-5-2-4">Basic authorization model</a></li>
<li><a href="#sec-2-5-2-5">Enable non-authorized search&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-6">Raw Elasticsearch DSL endpoint</a>
<ul>
<li><a href="#sec-2-6-1">Pagination parameters in URL (?)</a></li>
<li><a href="#sec-2-6-2">Valid JSON-API for the raw Elasticsearch DSL endpoint</a></li>
</ul>
</li>
<li><a href="#sec-2-7">JSONAPI-compliant Request Format</a>
<ul>
<li><a href="#sec-2-7-1"><span class="done DONE">DONE</span> Correct 'links'</a></li>
<li><a href="#sec-2-7-2"><span class="done DONE">DONE</span> Compare with mu-cl-resources filter syntax</a></li>
<li><a href="#sec-2-7-3"><span class="done DONE">DONE</span> Search all fields</a></li>
<li><a href="#sec-2-7-4"><span class="done DONE">DONE</span> All simple search methods</a></li>
<li><a href="#sec-2-7-5"><span class="done DONE">DONE</span> Multi Match</a></li>
<li><a href="#sec-2-7-6"><span class="done DONE">DONE</span> Sorting</a></li>
<li><a href="#sec-2-7-7"><span class="done DONE">DONE</span> Common Terms</a></li>
<li><a href="#sec-2-7-8"><span class="done DONE">DONE</span> Prefix, wildcard, regexp</a></li>
<li><a href="#sec-2-7-9"><span class="done DONE">DONE</span> Query String</a></li>
<li><a href="#sec-2-7-10"><span class="done DONE">DONE</span> Terms</a></li>
<li><a href="#sec-2-7-11"><span class="done DONE">DONE</span> Term sets</a></li>
<li><a href="#sec-2-7-12"><span class="done DONE">DONE</span> Fuzzy search</a></li>
<li><a href="#sec-2-7-13"><span class="done DONE">DONE</span> Ranges</a></li>
<li><a href="#sec-2-7-14">Other parameters</a></li>
<li><a href="#sec-2-7-15">Distinguish between 'query' and 'filter'</a></li>
</ul>
</li>
<li><a href="#sec-2-8">JSONAPI-compliant response</a>
<ul>
<li><a href="#sec-2-8-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></a></li>
</ul>
</li>
<li><a href="#sec-2-9">Querying multiple types</a>
<ul>
<li><a href="#sec-2-9-1">Configurable endpoints for multiple types&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a>
<ul>
<li><a href="#sec-2-9-1-1"><span class="done DONE">DONE</span> Refactor, clean up</a></li>
<li><a href="#sec-2-9-1-2"><span class="done DONE">DONE</span> JSON-API formatted response</a></li>
<li><a href="#sec-2-9-1-3"><span class="done DONE">DONE</span> Enable default mappings when mapping is absent</a></li>
<li><a href="#sec-2-9-1-4"><span class="done DONE">DONE</span> Type name for JSONAPI compliant response</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2-10">Stored indexes</a>
<ul>
<li><a href="#sec-2-10-1"><span class="done DONE">DONE</span> Store indexes on disk</a></li>
<li><a href="#sec-2-10-2"><span class="todo TODO">TODO</span> Consume deltas on booting up to ensure indexes are correct</a></li>
<li><a href="#sec-2-10-3"><span class="todo TODO">TODO</span> Endpoint for resetting stored indexes, and documentation</a></li>
</ul>
</li>
<li><a href="#sec-2-11">Eager indexing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a>
<ul>
<li><a href="#sec-2-11-1"><span class="done DONE">DONE</span> Build indexes on boot-up&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-11-2"><span class="done DONE">DONE</span> Discover when the SPARQL endpoint is ‘up’&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-11-3"><span class="done DONE">DONE</span> Build a fresh index once everything has been booted up correctly&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-11-4"><span class="todo TODO">TODO</span> Allow groups to be specified by SPARQL Query&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-11-5">Store the status of your microservice in the triplestore&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-2-12">Automatic index invalidation</a>
<ul>
<li><a href="#sec-2-12-1"><span class="done DONE">DONE</span> Automatically calculate the index when no index exists&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span></span></a></li>
<li><a href="#sec-2-12-2"><span class="done DONE">DONE</span> Define configuration language&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span></span></a></li>
<li><a href="#sec-2-12-3"><span class="done DONE">DONE</span> Configure lookup table&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-12-4"><span class="done DONE">DONE</span> Incorporate multi-types&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-12-5">Use 'graph' from deltas to check for correct graph&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-12-6">Invert delta processing loops for per-index blocking&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-12-7"><span class="done DONE">DONE</span> Test authorization before invalidating index&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-12-8"><span class="done DONE">DONE</span> Split tabulate and invalidate into 2 functions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-12-9"><span class="done DONE">DONE</span> Cover all cases in invalidation endpoint</a></li>
</ul>
</li>
<li><a href="#sec-2-13">Automatic index updating</a>
<ul>
<li><a href="#sec-2-13-1"><span class="done DONE">DONE</span> Create feature flag&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-13-2"><span class="done DONE">DONE</span> Build a mapping language&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-13-3"><span class="done DONE">DONE</span> Apply the updates as input arrives&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-13-4"><span class="done DONE">DONE</span> Update documents only in authorized indexes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="problem">problem</span>&#xa0;<span class="v1">v1</span></span></a></li>
<li><a href="#sec-2-13-5"><span class="done DONE">DONE</span> Error handling for non-existent etc. documents&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-2-14">Monitor configuration</a>
<ul>
<li><a href="#sec-2-14-1"><span class="done DONE">DONE</span> Detect when the config files change</a></li>
<li><a href="#sec-2-14-2"><span class="done DONE">DONE</span> bug: existing indexes are still getting rebuilt</a></li>
<li><a href="#sec-2-14-3"><span class="done DONE">DONE</span> bug: indexes not getting removed from triplestore (?)</a></li>
<li><a href="#sec-2-14-4"><span class="done DONE">DONE</span> Destroy all indexes on changes</a></li>
<li><a href="#sec-2-14-5"><span class="done DONE">DONE</span> Rebuild the necessary indexes</a></li>
<li><a href="#sec-2-14-6"><span class="done DONE">DONE</span> Ensure indexes may be lazy-loaded during development</a></li>
<li><a href="#sec-2-14-7"><span class="done DONE">DONE</span> Index is 'deleted' multiple times on reload</a></li>
<li><a href="#sec-2-14-8"><span class="done DONE">DONE</span> When changing config from persistent to non-persistent</a></li>
</ul>
</li>
<li><a href="#sec-2-15">Eager indexing from the semantic model</a>
<ul>
<li><a href="#sec-2-15-1">Configure with SPARQL</a></li>
<li><a href="#sec-2-15-2">Configure Delta triggers</a></li>
<li><a href="#sec-2-15-3">Update when groups change</a></li>
</ul>
</li>
<li><a href="#sec-2-16">Cache</a>
<ul>
<li><a href="#sec-2-16-1">make caches clearable</a></li>
<li><a href="#sec-2-16-2">clear cache endpoints</a></li>
<li><a href="#sec-2-16-3">use deltas to clear caches</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-3">Code and Testing</a>
<ul>
<li><a href="#sec-3-1">Architecture</a>
<ul>
<li><a href="#sec-3-1-1">v0 planning&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span></span></a>
<ul>
<li><a href="#sec-3-1-1-1">Task definition&#xa0;&#xa0;&#xa0;<span class="tag"><span class="billed">billed</span></span></a></li>
</ul>
</li>
<li><a href="#sec-3-1-2">v1 planning&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-3-2">Code Organization</a>
<ul>
<li><a href="#sec-3-2-1">Use RequestStore for request-specific globals&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-3-2-2">Should memoization be per-request? or short-lived&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-3-3">Error Handling</a>
<ul>
<li><a href="#sec-3-3-1"><span class="done DONE">DONE</span> Error handling on index creation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-3-3-2"><span class="done DONE">DONE</span> On error, break out of :invalid/:updating loop&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
<li><a href="#sec-3-4">Testing</a>
<ul>
<li><a href="#sec-3-4-1">Full testing setup with rewriter&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span>&#xa0;<span class="in_progress">in_progress</span></span></a>
<ul>
<li><a href="#sec-3-4-1-1"><span class="done DONE">DONE</span> write plugin</a></li>
<li><a href="#sec-3-4-1-2"><span class="done DONE">DONE</span> set up deltas</a></li>
<li><a href="#sec-3-4-1-3">modify rewriter to format queried annotations</a></li>
</ul>
</li>
<li><a href="#sec-3-4-2"><span class="done DONE">DONE</span> Write tests for automatic index invalidation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
<li><a href="#sec-3-4-3"><span class="done DONE">DONE</span> Write tests for automatic index updating&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">Bugs</a></li>
<li><a href="#sec-5">Admin</a>
<ul>
<li><a href="#sec-5-1">Project management</a></li>
<li><a href="#sec-5-2">Calls</a>
<ul>
<li><a href="#sec-5-2-1">Initial call&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></a></li>
<li><a href="#sec-5-2-2">Authorization model and project definition&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></a></li>
</ul>
</li>
<li><a href="#sec-5-3">Documentation</a>
<ul>
<li><a href="#sec-5-3-1">v1 docs&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-6">Reporting</a>
<ul>
<li><a href="#sec-6-1">Milestones</a>
<ul>
<li><a href="#sec-6-1-1">v0</a></li>
<li><a href="#sec-6-1-2">v1</a></li>
<li><a href="#sec-6-1-3">total</a></li>
</ul>
</li>
<li><a href="#sec-6-2">Invoices</a>
<ul>
<li><a href="#sec-6-2-1">Invoice 1&#xa0;&#xa0;&#xa0;<span class="tag"><span class="sent">sent</span></span></a></li>
<li><a href="#sec-6-2-2">Invoice 2</a></li>
<li><a href="#sec-6-2-3">Invoice 3</a></li>
<li><a href="#sec-6-2-4">Invoice 4</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Questions</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Auth model, once and for all</h3>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">how to specify eager-indexing groups by sparql query?</h3>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Specify 'eager indexing from the semantic model'</h3>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Features</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Environment</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></h4>
<div class="outline-text-4" id="text-2-1-1">
</div>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><span class="todo TODO">TODO</span> Wait until Elasticsearch is loaded before loading</h4>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Configuration language</h3>
<div class="outline-text-3" id="text-2-2">
</div><div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></h4>
<div class="outline-text-4" id="text-2-2-1">
</div>
<div id="outline-container-sec-2-2-1-1" class="outline-5">
<h5 id="sec-2-2-1-1">Construct configuration language</h5>
<div class="outline-text-5" id="text-2-2-1-1">
<p>
Construct configuration language to map base paths `/&lt;type&gt;` to SPARQL queries: eg: `/users` maps to 
</p>

<div class="org-src-container">

<pre class="src src-sparql">SELECT ?name ?description
WHERE {
  ?uri a foaf:Agent;
       foaf:name ?name;
       dct:description ?description.
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2"><span class="done DONE">DONE</span> Allow lists of predicates for property paths&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
eg ex:hasName/foaf:name =&gt; ["ex:hasName", "foaf:name"]
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Architecture</h3>
<div class="outline-text-3" id="text-2-3">
</div><div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1">Harmonize naming&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
rights/indexes
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Indexing</h3>
<div class="outline-text-3" id="text-2-4">
</div><div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="done DONE">DONE</span> Construct the index endpoint</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
Index on path `/&lt;type&gt;/make-index`
</p>
</div>
</div>

<div id="outline-container-sec-2-4-2" class="outline-4">
<h4 id="sec-2-4-2"><span class="done DONE">DONE</span> Indexing endpoint for all cases</h4>
<div class="outline-text-4" id="text-2-4-2">
</div>
</div>
<div id="outline-container-sec-2-4-3" class="outline-4">
<h4 id="sec-2-4-3"><span class="done DONE">DONE</span> Batch-process indexing</h4>
</div>
<div id="outline-container-sec-2-4-4" class="outline-4">
<h4 id="sec-2-4-4">Multithreading and blocking&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-4-4">
</div>
<div id="outline-container-sec-2-4-4-1" class="outline-5">
<h5 id="sec-2-4-4-1"><span class="done DONE">DONE</span> Block simultaneous queries on new/invalid index</h5>
<div class="outline-text-5" id="text-2-4-4-1">
<p>
For two queries using the same index, there is no point in the 2nd
one rebuilding the index.
And, wait for updated index before searching.
</p>
</div>
</div>
<div id="outline-container-sec-2-4-4-2" class="outline-5">
<h5 id="sec-2-4-4-2">Queue and/or block multiple updates from deltas</h5>
<div class="outline-text-5" id="text-2-4-4-2">
<p>
And with deltas, multiple incoming deltas should be&#x2026; queued?
each one started and canceled?
</p>

<p>
Should individual document updates make searches wait?
ie, status = :updating
</p>
</div>
</div>
<div id="outline-container-sec-2-4-4-3" class="outline-5">
<h5 id="sec-2-4-4-3"><span class="todo TODO">TODO</span> What about new invalidation in the middle of updating?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="question">question</span></span></h5>
<div class="outline-text-5" id="text-2-4-4-3">
</div><ul class="org-ul"><li><a id="sec-2-4-4-3-1" name="sec-2-4-4-3-1"></a>First step: block and wait<br  /></li>
<li><a id="sec-2-4-4-3-2" name="sec-2-4-4-3-2"></a>Second step: can we kill it?<br  /><div class="outline-text-6" id="text-2-4-4-3-2">
<p>
Save updating thread to allow it to be cancelled? 
</p>

<ul class="org-ul">
<li>save thread
</li>
<li>kill thread
</li>
<li>but also need a way to signal back to original updater to
continue (and wait at next waiting point)&#x2026; either a signal,
or an index-specific mutex just around the updating code
</li>
</ul>
</div>
</li></ul>
</div>
</div>
<div id="outline-container-sec-2-4-5" class="outline-4">
<h4 id="sec-2-4-5"><span class="done DONE">DONE</span> On initial indexing, wait before count query&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
<div id="outline-container-sec-2-4-6" class="outline-4">
<h4 id="sec-2-4-6">Correct use of application graph&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span>&#xa0;<span class="fix">fix</span></span></h4>
</div>
<div id="outline-container-sec-2-4-7" class="outline-4">
<h4 id="sec-2-4-7"><span class="done DONE">DONE</span> Endpoints for resetting, invalidation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-4-7">
</div><div id="outline-container-sec-2-4-7-1" class="outline-5">
<h5 id="sec-2-4-7-1"><span class="done DONE">DONE</span> index all indexes (per type), w/o auth_groups</h5>
</div>
<div id="outline-container-sec-2-4-7-2" class="outline-5">
<h5 id="sec-2-4-7-2"><span class="done DONE">DONE</span> invalidate</h5>
</div>
</div>
<div id="outline-container-sec-2-4-8" class="outline-4">
<h4 id="sec-2-4-8"><span class="done DONE">DONE</span> /index endpoint should delete all docs before indexing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Access Rights</h3>
<div class="outline-text-3" id="text-2-5">
<p>
In a next step, we assume access rights may spoil the initial
party.  We need to cope with access rights in order to figure out
what belongs together.  The most realistic path forward is to
consume the `mu-auth-used-groups` and compare them with the
`mu-auth-allowed-groups` for a specific query.
</p>

<ul class="org-ul">
<li>Read and parse `MU-AUTH-USED-GROUPS` and `MU-AUTH-ALLOWED-GROUPS`
when building index.
</li>
<li>Store `MU-AUTH-USED-GROUPS` and `MU-AUTH-ALLOWED-GROUPS` so you
can match on it later.
</li>
<li>Compare MU-AUTH-ALLOWED-GROUPS to select the index to query on
when the user poses a question.
</li>
</ul>

<blockquote>
<p>
NOTE MU-AUTH-ALLOWED-GROUPS always contains the groups from which
the current user may select.  These are included with the request
that’s received from the user.  (If no MU-AUTH-ALLOWED-GROUPS is
received, it will be calculated on the first request to the
database.) MU-AUTH-USED-GROUPS is received when a user poses a
question to the database.  This array follows the same form as
MU-AUTH-ALLOWED-GROUPS.  It is an array of objects.  If the value
for the name property of one of these objects appears in
MU-AUTH-ALLOWED-GROUPS, but not in MU-AUTH-USED-GROUPS, then it
will never appear there.  This means that if a user pops along, and
they have the same access rights as a MU-AUTH-ALLOWED-GROUPS of a
previous query, you will receive the same values again.  If the
user has less MU-AUTH-ALLOWED-GROUPS, but none which appear in
MU-AUTH-USED-GROUPs, the same index can be used once again.
</p>
</blockquote>
</div>

<div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></h4>
<div class="outline-text-4" id="text-2-5-1">
</div>
</div>
<div id="outline-container-sec-2-5-2" class="outline-4">
<h4 id="sec-2-5-2">Basic access rights storage and lookup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-5-2">
</div>
<div id="outline-container-sec-2-5-2-1" class="outline-5">
<h5 id="sec-2-5-2-1"><span class="done DONE">DONE</span> Store and lookup indexes in memory</h5>
</div>
<div id="outline-container-sec-2-5-2-2" class="outline-5">
<h5 id="sec-2-5-2-2"><span class="done DONE">DONE</span> Serialize to triplestore and load at boot-up.</h5>
<div class="outline-text-5" id="text-2-5-2-2">
<p>
Load at boot-up, and serialize at each addition.
</p>
</div>
</div>
<div id="outline-container-sec-2-5-2-3" class="outline-5">
<h5 id="sec-2-5-2-3"><span class="done DONE">DONE</span> Finalize vocabulary for storing in triple-store</h5>
<div class="outline-text-5" id="text-2-5-2-3">
<p>
Finalize vocabulary. 
</p>
</div>
</div>
<div id="outline-container-sec-2-5-2-4" class="outline-5">
<h5 id="sec-2-5-2-4">Basic authorization model</h5>
<div class="outline-text-5" id="text-2-5-2-4">
<p>
For:
</p>

<ul class="org-ul">
<li>a stored index with groups ALLOWED1 and USED1
</li>
<li>and a new search with groups ALLOWED2 and USED2
</li>
</ul>

<p>
the stored index can be used when ALLOWED1 &lt;= ALLOWED2 and USED2 &lt;= USED1
</p>
</div>
</div>
<div id="outline-container-sec-2-5-2-5" class="outline-5">
<h5 id="sec-2-5-2-5">Enable non-authorized search&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h5>
<div class="outline-text-5" id="text-2-5-2-5">
<p>
For testing - when no headers present
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6">Raw Elasticsearch DSL endpoint</h3>
<div class="outline-text-3" id="text-2-6">
</div><div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1">Pagination parameters in URL (?)</h4>
</div>
<div id="outline-container-sec-2-6-2" class="outline-4">
<h4 id="sec-2-6-2">Valid JSON-API for the raw Elasticsearch DSL endpoint</h4>
<div class="outline-text-4" id="text-2-6-2">
<p>
Get 'from' and 'size' from the query or defaults, and calculate pagination.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7">JSONAPI-compliant Request Format</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-sec-2-7-1" class="outline-4">
<h4 id="sec-2-7-1"><span class="done DONE">DONE</span> Correct 'links'</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
Pagination is done, but need to provide full 'next', 'self', 'first', and 'last' links
</p>
</div>
</div>
<div id="outline-container-sec-2-7-2" class="outline-4">
<h4 id="sec-2-7-2"><span class="done DONE">DONE</span> Compare with mu-cl-resources filter syntax</h4>
</div>
<div id="outline-container-sec-2-7-3" class="outline-4">
<h4 id="sec-2-7-3"><span class="done DONE">DONE</span> Search all fields</h4>
<div class="outline-text-4" id="text-2-7-3">
<p>
Equivalent to ES's 'match_all'
</p>
</div>
</div>
<div id="outline-container-sec-2-7-4" class="outline-4">
<h4 id="sec-2-7-4"><span class="done DONE">DONE</span> All simple search methods</h4>
</div>
<div id="outline-container-sec-2-7-5" class="outline-4">
<h4 id="sec-2-7-5"><span class="done DONE">DONE</span> Multi Match</h4>
<div class="outline-text-4" id="text-2-7-5">
<p>
GET /_search
{
  "query": {
    "multi_match" : {
      "query":    "this is a test", 
      "fields": [ "subject", "message" ] 
    }
  }
  }
</p>
</div>
</div>
<div id="outline-container-sec-2-7-6" class="outline-4">
<h4 id="sec-2-7-6"><span class="done DONE">DONE</span> Sorting</h4>
</div>
<div id="outline-container-sec-2-7-7" class="outline-4">
<h4 id="sec-2-7-7"><span class="done DONE">DONE</span> Common Terms</h4>
<div class="outline-text-4" id="text-2-7-7">
<p>
    {
    "query": {
        "common": {
            "body": {
                "query": "this is bonsai cool",
                "cutoff_frequency": 0.001
            }
        }
    }
}
</p>
</div>
</div>

<div id="outline-container-sec-2-7-8" class="outline-4">
<h4 id="sec-2-7-8"><span class="done DONE">DONE</span> Prefix, wildcard, regexp</h4>
</div>
<div id="outline-container-sec-2-7-9" class="outline-4">
<h4 id="sec-2-7-9"><span class="done DONE">DONE</span> Query String</h4>
<div class="outline-text-4" id="text-2-7-9">
<p>
GET /_search
{
    "query": {
        "query_string" : {
            "default_field" : "content",
            "query" : "this AND that OR thus"
        }
    }
}
</p>

<p>
and simple:
</p>

<p>
GET /_search
{
  "query": {
    "simple_query_string" : {
        "query": "\"fried eggs\" +(eggplant | potato) -frittata",
        "fields": ["title^5", "body"],
        "default_operator": "and"
    }
  }
}
</p>
</div>
</div>
<div id="outline-container-sec-2-7-10" class="outline-4">
<h4 id="sec-2-7-10"><span class="done DONE">DONE</span> Terms</h4>
<div class="outline-text-4" id="text-2-7-10">
<p>
POST _search
{
  "query": {
    "term" : { "user" : "Kimchy" } 
  }
}
</p>
</div>
</div>
<div id="outline-container-sec-2-7-11" class="outline-4">
<h4 id="sec-2-7-11"><span class="done DONE">DONE</span> Term sets</h4>
<div class="outline-text-4" id="text-2-7-11">
<p>
GET /_search
{
    "query": {
        "terms" : { "user" : ["kimchy", "elasticsearch"]}
    }
}
</p>
</div>
</div>
<div id="outline-container-sec-2-7-12" class="outline-4">
<h4 id="sec-2-7-12"><span class="done DONE">DONE</span> Fuzzy search</h4>
</div>
<div id="outline-container-sec-2-7-13" class="outline-4">
<h4 id="sec-2-7-13"><span class="done DONE">DONE</span> Ranges</h4>
</div>
<div id="outline-container-sec-2-7-14" class="outline-4">
<h4 id="sec-2-7-14">Other parameters</h4>
<div class="outline-text-4" id="text-2-7-14">
<p>
boost, etc.
</p>
</div>
</div>
<div id="outline-container-sec-2-7-15" class="outline-4">
<h4 id="sec-2-7-15">Distinguish between 'query' and 'filter'</h4>
</div>
</div>
<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8">JSONAPI-compliant response</h3>
<div class="outline-text-3" id="text-2-8">
</div><div id="outline-container-sec-2-8-1" class="outline-4">
<h4 id="sec-2-8-1"><span class="done DONE">DONE</span> Initial setup&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></h4>
<div class="outline-text-4" id="text-2-8-1">
</div>
</div>
</div>
<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9">Querying multiple types</h3>
<div class="outline-text-3" id="text-2-9">
<p>
It should be possible to query over multiple types at the same
time.  For instance, we may want to search for users, topics, and
content, within a single search query.  This needs to be configured
in order to set the appropriate weights.
</p>
</div>

<div id="outline-container-sec-2-9-1" class="outline-4">
<h4 id="sec-2-9-1">Configurable endpoints for multiple types&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-9-1">
<p>
Add parameter in config.json, and search multiple indexes.
</p>
</div>
<div id="outline-container-sec-2-9-1-1" class="outline-5">
<h5 id="sec-2-9-1-1"><span class="done DONE">DONE</span> Refactor, clean up</h5>
<div class="outline-text-5" id="text-2-9-1-1">
<p>
The inversion currently performed in make_index should be done at
config time, and in general, the config format should be
simplified.
</p>
</div>
</div>
<div id="outline-container-sec-2-9-1-2" class="outline-5">
<h5 id="sec-2-9-1-2"><span class="done DONE">DONE</span> JSON-API formatted response</h5>
</div>
<div id="outline-container-sec-2-9-1-3" class="outline-5">
<h5 id="sec-2-9-1-3"><span class="done DONE">DONE</span> Enable default mappings when mapping is absent</h5>
</div>
<div id="outline-container-sec-2-9-1-4" class="outline-5">
<h5 id="sec-2-9-1-4"><span class="done DONE">DONE</span> Type name for JSONAPI compliant response</h5>
</div>
</div>
</div>
<div id="outline-container-sec-2-10" class="outline-3">
<h3 id="sec-2-10">Stored indexes</h3>
<div class="outline-text-3" id="text-2-10">
<p>
When the application is stopped, and booted up again, the indexes
don’t need to rebuilt, they can be stored.  As long as the contents
of the triplestore haven’t changed when the system was offline,
it’s safe to assume the index is still in tact.
</p>

<blockquote>
<p>
NOTE The Delta service is currently rather naïve in that it assumes
everybody is listening by the time it detects changes. There’s a fair
chance your service boots up too late, and therefore misses some of
these Deltas.  It is an ongoing story to upgrade the Delta service so
you can receive recent changes when booting up.
</p>
</blockquote>
</div>

<div id="outline-container-sec-2-10-1" class="outline-4">
<h4 id="sec-2-10-1"><span class="done DONE">DONE</span> Store indexes on disk</h4>
</div>
<div id="outline-container-sec-2-10-2" class="outline-4">
<h4 id="sec-2-10-2"><span class="todo TODO">TODO</span> Consume deltas on booting up to ensure indexes are correct</h4>
</div>
<div id="outline-container-sec-2-10-3" class="outline-4">
<h4 id="sec-2-10-3"><span class="todo TODO">TODO</span> Endpoint for resetting stored indexes, and documentation</h4>
<div class="outline-text-4" id="text-2-10-3">
</div>
</div>
</div>
<div id="outline-container-sec-2-11" class="outline-3">
<h3 id="sec-2-11">Eager indexing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h3>
<div class="outline-text-3" id="text-2-11">
<p>
Indexing on first request has its downsides.  We should be able to
answer to initial requests quickly, given a set of expected access
patterns.  When the stack boots up, we will build the indexes for a
predefined set of MU_AUTH_ALLOWED_GROUPS so users will receive answers
quickly.
</p>
</div>
<div id="outline-container-sec-2-11-1" class="outline-4">
<h4 id="sec-2-11-1"><span class="done DONE">DONE</span> Build indexes on boot-up&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-11-1">
<p>
Build a configuration which indicates the MU_AUTH_ALLOWED_GROUPS
to be scanned per index (some search indexes may have different
MU_AUTH_ALLOWED_GROUPS)
</p>
</div>
</div>
<div id="outline-container-sec-2-11-2" class="outline-4">
<h4 id="sec-2-11-2"><span class="done DONE">DONE</span> Discover when the SPARQL endpoint is ‘up’&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-11-2">
<p>
so you can wait if your microservice boots up quicker than
Virtuoso and/or mu-authorization.
</p>
</div>
</div>
<div id="outline-container-sec-2-11-3" class="outline-4">
<h4 id="sec-2-11-3"><span class="done DONE">DONE</span> Build a fresh index once everything has been booted up correctly&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-11-3">
<p>
Note that you may start receiving Deltas at the same time, so you
may want to hold off for a moment when starting to build the first
indexes.
</p>
</div>
</div>
<div id="outline-container-sec-2-11-4" class="outline-4">
<h4 id="sec-2-11-4"><span class="todo TODO">TODO</span> Allow groups to be specified by SPARQL Query&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-11-4">
<p>
how to do this? need example data&#x2026;
</p>
</div>
</div>
<div id="outline-container-sec-2-11-5" class="outline-4">
<h4 id="sec-2-11-5">Store the status of your microservice in the triplestore&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-11-5">
<ul class="org-ul">
<li>Waiting to index
</li>
<li>Indexing
</li>
<li>Finished indexing
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2-12" class="outline-3">
<h3 id="sec-2-12">Automatic index invalidation</h3>
<div class="outline-text-3" id="text-2-12">
<p>
When users pose a question, we can verify the index, and update it
automatically.  We will consume the Delta supplied by
mu-authorization to detect possibly destructive changes. Because of
this, we need to have a thorough understanding of the contents
which need to be indexed.  As such, we need to define a new
specification language to easily reason on.  The specifics of this
approach need some further detailing.
</p>
</div>

<div id="outline-container-sec-2-12-1" class="outline-4">
<h4 id="sec-2-12-1"><span class="done DONE">DONE</span> Automatically calculate the index when no index exists&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span></span></h4>
</div>
<div id="outline-container-sec-2-12-2" class="outline-4">
<h4 id="sec-2-12-2"><span class="done DONE">DONE</span> Define configuration language&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span></span></h4>
<div class="outline-text-4" id="text-2-12-2">
<p>
Define a configuration language to indicate which fields (or
paths) need to be indexed (this replaces the earlier SPARQL query)
</p>
</div>
</div>
<div id="outline-container-sec-2-12-3" class="outline-4">
<h4 id="sec-2-12-3"><span class="done DONE">DONE</span> Configure lookup table&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-12-3">
</div>
</div>
<div id="outline-container-sec-2-12-4" class="outline-4">
<h4 id="sec-2-12-4"><span class="done DONE">DONE</span> Incorporate multi-types&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-12-4">
</div>
</div>

<div id="outline-container-sec-2-12-5" class="outline-4">
<h4 id="sec-2-12-5">Use 'graph' from deltas to check for correct graph&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
<div id="outline-container-sec-2-12-6" class="outline-4">
<h4 id="sec-2-12-6">Invert delta processing loops for per-index blocking&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-12-6">
<p>
Or maybe not. Not sure if this is really necessary.
</p>
</div>
</div>
<div id="outline-container-sec-2-12-7" class="outline-4">
<h4 id="sec-2-12-7"><span class="done DONE">DONE</span> Test authorization before invalidating index&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
<div id="outline-container-sec-2-12-8" class="outline-4">
<h4 id="sec-2-12-8"><span class="done DONE">DONE</span> Split tabulate and invalidate into 2 functions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
<div id="outline-container-sec-2-12-9" class="outline-4">
<h4 id="sec-2-12-9"><span class="done DONE">DONE</span> Cover all cases in invalidation endpoint</h4>
<div class="outline-text-4" id="text-2-12-9">
<p>
authorized and not, type specified or not
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-13" class="outline-3">
<h3 id="sec-2-13">Automatic index updating</h3>
<div class="outline-text-3" id="text-2-13">
<p>
Instead of invalidating the index, let’s update it dynamically.
</p>

<p>
Many events from the delta service could be translated directly to
index updates, rather than index invalidations.  We will detect the
changes to be made, and apply them directly.  It is ok to pose further
queries to the SPARQL endpoint in order to figure out the impact of
the change.
</p>

<blockquote>
<p>
NOTE This section currently ignores the access rights
with respect to the Delta Service.  Description of the access
rights should be considered in another tasks which runs parallel to
this one.  The inclusion of access rights with the delta service
will have an impact on how this story unfolds.  It is safe to
assume that the MU_AUTH_USED_GROUPS for a given
MU_AUTH_ALLOWED_GROUPS will never change.
</p>
</blockquote>
</div>

<div id="outline-container-sec-2-13-1" class="outline-4">
<h4 id="sec-2-13-1"><span class="done DONE">DONE</span> Create feature flag&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-13-1">
<p>
Create feature flag to choose between updating the index, and
clearing the index
</p>
</div>
</div>
<div id="outline-container-sec-2-13-2" class="outline-4">
<h4 id="sec-2-13-2"><span class="done DONE">DONE</span> Build a mapping language&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-13-2">
<p>
Build a mapping language from the Delta Input which caused
invalidation, to logic which identifies the applicable update
</p>
</div>
</div>
<div id="outline-container-sec-2-13-3" class="outline-4">
<h4 id="sec-2-13-3"><span class="done DONE">DONE</span> Apply the updates as input arrives&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-13-3">
</div>
</div>
<div id="outline-container-sec-2-13-4" class="outline-4">
<h4 id="sec-2-13-4"><span class="done DONE">DONE</span> Update documents only in authorized indexes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="problem">problem</span>&#xa0;<span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-2-13-4">
</div>
</div>
<div id="outline-container-sec-2-13-5" class="outline-4">
<h4 id="sec-2-13-5"><span class="done DONE">DONE</span> Error handling for non-existent etc. documents&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
</div>
<div id="outline-container-sec-2-14" class="outline-3">
<h3 id="sec-2-14">Monitor configuration</h3>
<div class="outline-text-3" id="text-2-14">
<p>
When configuring the search service during development, it is to be
expected that the configuration will change often.  Many microservices
monitor their configuration/code in development mode, and refresh
their state when changes occur.
</p>
</div>

<div id="outline-container-sec-2-14-1" class="outline-4">
<h4 id="sec-2-14-1"><span class="done DONE">DONE</span> Detect when the config files change</h4>
</div>
<div id="outline-container-sec-2-14-2" class="outline-4">
<h4 id="sec-2-14-2"><span class="done DONE">DONE</span> bug: existing indexes are still getting rebuilt</h4>
</div>
<div id="outline-container-sec-2-14-3" class="outline-4">
<h4 id="sec-2-14-3"><span class="done DONE">DONE</span> bug: indexes not getting removed from triplestore (?)</h4>
</div>
<div id="outline-container-sec-2-14-4" class="outline-4">
<h4 id="sec-2-14-4"><span class="done DONE">DONE</span> Destroy all indexes on changes</h4>
</div>
<div id="outline-container-sec-2-14-5" class="outline-4">
<h4 id="sec-2-14-5"><span class="done DONE">DONE</span> Rebuild the necessary indexes</h4>
</div>
<div id="outline-container-sec-2-14-6" class="outline-4">
<h4 id="sec-2-14-6"><span class="done DONE">DONE</span> Ensure indexes may be lazy-loaded during development</h4>
</div>
<div id="outline-container-sec-2-14-7" class="outline-4">
<h4 id="sec-2-14-7"><span class="done DONE">DONE</span> Index is 'deleted' multiple times on reload</h4>
<div class="outline-text-4" id="text-2-14-7">
<p>
maye only with persistence?
</p>
</div>
</div>
<div id="outline-container-sec-2-14-8" class="outline-4">
<h4 id="sec-2-14-8"><span class="done DONE">DONE</span> When changing config from persistent to non-persistent</h4>
<div class="outline-text-4" id="text-2-14-8">
<p>
Error on searching a non-preloaded index
only when actually have done /search on previous settings
so getting lodged in somewhere
</p>

<p>
one solution: don't use 'set :x' for reloading, but that makes it
unintuitive sinatra
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-15" class="outline-3">
<h3 id="sec-2-15">Eager indexing from the semantic model</h3>
<div class="outline-text-3" id="text-2-15">
<p>
Some configuration regarding the MU_AUTH_ALLOWED_GROUPS may be
dependent on data in the system.  The search should update this
part of its configuration based on SPARQL queries, rather than
based on configuration files.
</p>

<blockquote>
<p>
NOTE It is clear that, at some point, the Delta service
should be able to inform your service about potential changes to the
result of particular SPARQL queries.  This is an ongoing effort, but
is not expected to mature by the time the search is complete.  We will
therefore let the user manage this in configuration.
</p>
</blockquote>
</div>

<div id="outline-container-sec-2-15-1" class="outline-4">
<h4 id="sec-2-15-1">Configure with SPARQL</h4>
<div class="outline-text-4" id="text-2-15-1">
<p>
Allow the user to construct the configuration for
MU_AUTH_ALLOWED_GROUPS with a SPARQL query
</p>
</div>
</div>
<div id="outline-container-sec-2-15-2" class="outline-4">
<h4 id="sec-2-15-2">Configure Delta triggers</h4>
<div class="outline-text-4" id="text-2-15-2">
<p>
Allow the user to construct the configuration which defines which
Deltas trigger recalculating the MU_AUTH_ALLOWED_GROUPS
configuration function
</p>
</div>
</div>
<div id="outline-container-sec-2-15-3" class="outline-4">
<h4 id="sec-2-15-3">Update when groups change</h4>
<div class="outline-text-4" id="text-2-15-3">
<p>
Update the indexes only when the resulting MU_AUTH_ALLOWED_GROUPS
have changed
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-16" class="outline-3">
<h3 id="sec-2-16">Cache</h3>
<div class="outline-text-3" id="text-2-16">
</div>
<div id="outline-container-sec-2-16-1" class="outline-4">
<h4 id="sec-2-16-1">make caches clearable</h4>
</div>
<div id="outline-container-sec-2-16-2" class="outline-4">
<h4 id="sec-2-16-2">clear cache endpoints</h4>
</div>
<div id="outline-container-sec-2-16-3" class="outline-4">
<h4 id="sec-2-16-3">use deltas to clear caches</h4>
<div class="outline-text-4" id="text-2-16-3">
<p>
how??
</p>

<p>
probably need to specify predicates in config
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Code and Testing</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Architecture</h3>
<div class="outline-text-3" id="text-3-1">
</div><div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">v0 planning&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span></span></h4>
<div class="outline-text-4" id="text-3-1-1">
</div><div id="outline-container-sec-3-1-1-1" class="outline-5">
<h5 id="sec-3-1-1-1">Task definition&#xa0;&#xa0;&#xa0;<span class="tag"><span class="billed">billed</span></span></h5>
<div class="outline-text-5" id="text-3-1-1-1">
</div>
</div>
</div>

<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2">v1 planning&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-3-1-2">
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Code Organization</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1">Use RequestStore for request-specific globals&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
for instance, for:
</p>
<ul class="org-ul">
<li>path
</li>
<li>groups
</li>
<li>index
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2">Should memoization be per-request? or short-lived&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
The problem being if types change, etc.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Error Handling</h3>
<div class="outline-text-3" id="text-3-3">
</div>

<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="done DONE">DONE</span> Error handling on index creation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="done DONE">DONE</span> On error, break out of :invalid/:updating loop&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Testing</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-sec-3-4-1" class="outline-4">
<h4 id="sec-3-4-1">Full testing setup with rewriter&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span>&#xa0;<span class="in_progress">in_progress</span></span></h4>
<div class="outline-text-4" id="text-3-4-1">
</div>
<div id="outline-container-sec-3-4-1-1" class="outline-5">
<h5 id="sec-3-4-1-1"><span class="done DONE">DONE</span> write plugin</h5>
</div>
<div id="outline-container-sec-3-4-1-2" class="outline-5">
<h5 id="sec-3-4-1-2"><span class="done DONE">DONE</span> set up deltas</h5>
</div>
<div id="outline-container-sec-3-4-1-3" class="outline-5">
<h5 id="sec-3-4-1-3">modify rewriter to format queried annotations</h5>
<div class="outline-text-5" id="text-3-4-1-3">
<p>
Mu-Queried-Cache-Annotations as { name: , value: }
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="done DONE">DONE</span> Write tests for automatic index invalidation&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
<div id="outline-container-sec-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="done DONE">DONE</span> Write tests for automatic index updating&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Bugs</h2>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Admin</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Project management</h3>
<div class="outline-text-3" id="text-5-1">
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Calls</h3>
<div class="outline-text-3" id="text-5-2">
</div><div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1">Initial call&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></h4>
<div class="outline-text-4" id="text-5-2-1">
</div>
</div>
<div id="outline-container-sec-5-2-2" class="outline-4">
<h4 id="sec-5-2-2">Authorization model and project definition&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v0">v0</span>&#xa0;<span class="billed">billed</span></span></h4>
<div class="outline-text-4" id="text-5-2-2">
</div>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">Documentation</h3>
<div class="outline-text-3" id="text-5-3">
</div><div id="outline-container-sec-5-3-1" class="outline-4">
<h4 id="sec-5-3-1">v1 docs&#xa0;&#xa0;&#xa0;<span class="tag"><span class="v1">v1</span></span></h4>
<div class="outline-text-4" id="text-5-3-1">
</div>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Reporting</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">Milestones</h3>
<div class="outline-text-3" id="text-6-1">
</div><div id="outline-container-sec-6-1-1" class="outline-4">
<h4 id="sec-6-1-1">v0</h4>
<div class="outline-text-4" id="text-6-1-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Clock summary at <span class="timestamp-wrapper"><span class="timestamp">[2018-10-24 mer. 19:43]</span></span></caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Headline</th>
<th scope="col" class="right">Time</th>
<th scope="col" class="right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>Total time</b></td>
<td class="right"><b>1d 0:00</b></td>
<td class="right">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Admin</td>
<td class="right">4:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Project management</td>
<td class="right">&#xa0;</td>
<td class="right">2:00</td>
</tr>

<tr>
<td class="left">&emsp; Calls</td>
<td class="right">&#xa0;</td>
<td class="right">2:00</td>
</tr>

<tr>
<td class="left">Features</td>
<td class="right">20:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Environment</td>
<td class="right">&#xa0;</td>
<td class="right">6:30</td>
</tr>

<tr>
<td class="left">&emsp; Configuration language</td>
<td class="right">&#xa0;</td>
<td class="right">1:30</td>
</tr>

<tr>
<td class="left">&emsp; Access Rights</td>
<td class="right">&#xa0;</td>
<td class="right">8:00</td>
</tr>

<tr>
<td class="left">&emsp; JSON-API compliant response</td>
<td class="right">&#xa0;</td>
<td class="right">4:00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-6-1-2" class="outline-4">
<h4 id="sec-6-1-2">v1</h4>
<div class="outline-text-4" id="text-6-1-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> Clock summary at <span class="timestamp-wrapper"><span class="timestamp">[2018-12-05 mer. 19:53]</span></span></caption>

<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Headline</th>
<th scope="col" class="left">Time</th>
<th scope="col" class="right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>Total time</b></td>
<td class="left"><b>1d 23:30</b></td>
<td class="right">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Features</td>
<td class="left">1d 9:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Configuration language</td>
<td class="left">&#xa0;</td>
<td class="right">1:00</td>
</tr>

<tr>
<td class="left">&emsp; Indexing</td>
<td class="left">&#xa0;</td>
<td class="right">6:00</td>
</tr>

<tr>
<td class="left">&emsp; Access Rights</td>
<td class="left">&#xa0;</td>
<td class="right">3:00</td>
</tr>

<tr>
<td class="left">&emsp; Querying multiple types</td>
<td class="left">&#xa0;</td>
<td class="right">8:30</td>
</tr>

<tr>
<td class="left">&emsp; Eager indexing</td>
<td class="left">&#xa0;</td>
<td class="right">4:00</td>
</tr>

<tr>
<td class="left">&emsp; Automatic index invalidation</td>
<td class="left">&#xa0;</td>
<td class="right">6:00</td>
</tr>

<tr>
<td class="left">&emsp; Automatic index updating</td>
<td class="left">&#xa0;</td>
<td class="right">5:00</td>
</tr>

<tr>
<td class="left">Code, Testing and Bugs</td>
<td class="left">11:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Tests</td>
<td class="left">&#xa0;</td>
<td class="right">11:30</td>
</tr>

<tr>
<td class="left">Admin</td>
<td class="left">2:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Architecture</td>
<td class="left">&#xa0;</td>
<td class="right">1:00</td>
</tr>

<tr>
<td class="left">&emsp; Documentation</td>
<td class="left">&#xa0;</td>
<td class="right">1:30</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-6-1-3" class="outline-4">
<h4 id="sec-6-1-3">total</h4>
<div class="outline-text-4" id="text-6-1-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> Clock summary at <span class="timestamp-wrapper"><span class="timestamp">[2018-11-27 mar. 19:23]</span></span></caption>

<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Headline</th>
<th scope="col" class="left">Time</th>
<th scope="col" class="right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>Total time</b></td>
<td class="left"><b>2d 10:00</b></td>
<td class="right">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Features</td>
<td class="left">2d 3:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Environment</td>
<td class="left">&#xa0;</td>
<td class="right">6:30</td>
</tr>

<tr>
<td class="left">&emsp; Configuration language</td>
<td class="left">&#xa0;</td>
<td class="right">1:45</td>
</tr>

<tr>
<td class="left">&emsp; Indexing</td>
<td class="left">&#xa0;</td>
<td class="right">6:00</td>
</tr>

<tr>
<td class="left">&emsp; Access Rights</td>
<td class="left">&#xa0;</td>
<td class="right">10:45</td>
</tr>

<tr>
<td class="left">&emsp; JSONAPI-compliant response</td>
<td class="left">&#xa0;</td>
<td class="right">4:00</td>
</tr>

<tr>
<td class="left">&emsp; Querying multiple types</td>
<td class="left">&#xa0;</td>
<td class="right">8:30</td>
</tr>

<tr>
<td class="left">&emsp; Eager indexing</td>
<td class="left">&#xa0;</td>
<td class="right">3:15</td>
</tr>

<tr>
<td class="left">&emsp; Automatic index invalidation</td>
<td class="left">&#xa0;</td>
<td class="right">5:45</td>
</tr>

<tr>
<td class="left">&emsp; Automatic index updating</td>
<td class="left">&#xa0;</td>
<td class="right">5:00</td>
</tr>

<tr>
<td class="left">Admin</td>
<td class="left">6:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Architecture</td>
<td class="left">&#xa0;</td>
<td class="right">3:00</td>
</tr>

<tr>
<td class="left">&emsp; Calls</td>
<td class="left">&#xa0;</td>
<td class="right">2:00</td>
</tr>

<tr>
<td class="left">&emsp; Documentation</td>
<td class="left">&#xa0;</td>
<td class="right">1:30</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">Invoices</h3>
<div class="outline-text-3" id="text-6-2">
</div><div id="outline-container-sec-6-2-1" class="outline-4">
<h4 id="sec-6-2-1">Invoice 1&#xa0;&#xa0;&#xa0;<span class="tag"><span class="sent">sent</span></span></h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
Sent November 1
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Headline</th>
<th scope="col" class="right">Time</th>
<th scope="col" class="right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>Total time</b></td>
<td class="right"><b>1d 0:00</b></td>
<td class="right">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Features</td>
<td class="right">20:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Environment</td>
<td class="right">&#xa0;</td>
<td class="right">6:30</td>
</tr>

<tr>
<td class="left">&emsp; Configuration language</td>
<td class="right">&#xa0;</td>
<td class="right">1:30</td>
</tr>

<tr>
<td class="left">&emsp; Access Rights</td>
<td class="right">&#xa0;</td>
<td class="right">8:00</td>
</tr>

<tr>
<td class="left">&emsp; JSONAPI-compliant response</td>
<td class="right">&#xa0;</td>
<td class="right">4:00</td>
</tr>

<tr>
<td class="left">Admin</td>
<td class="right">4:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Architecture</td>
<td class="right">&#xa0;</td>
<td class="right">2:00</td>
</tr>

<tr>
<td class="left">&emsp; Calls</td>
<td class="right">&#xa0;</td>
<td class="right">2:00</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-sec-6-2-2" class="outline-4">
<h4 id="sec-6-2-2">Invoice 2</h4>
<div class="outline-text-4" id="text-6-2-2">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 4:</span> Clock summary at <span class="timestamp-wrapper"><span class="timestamp">[2018-12-03 lun. 14:07]</span></span></caption>

<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Headline</th>
<th scope="col" class="left">Time</th>
<th scope="col" class="right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>Total time</b></td>
<td class="left"><b>1d 20:00</b></td>
<td class="right">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Features</td>
<td class="left">1d 9:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Configuration language</td>
<td class="left">&#xa0;</td>
<td class="right">1:00</td>
</tr>

<tr>
<td class="left">&emsp; Indexing</td>
<td class="left">&#xa0;</td>
<td class="right">6:00</td>
</tr>

<tr>
<td class="left">&emsp; Access Rights</td>
<td class="left">&#xa0;</td>
<td class="right">3:00</td>
</tr>

<tr>
<td class="left">&emsp; Querying multiple types</td>
<td class="left">&#xa0;</td>
<td class="right">8:30</td>
</tr>

<tr>
<td class="left">&emsp; Eager indexing</td>
<td class="left">&#xa0;</td>
<td class="right">4:00</td>
</tr>

<tr>
<td class="left">&emsp; Automatic index invalidation</td>
<td class="left">&#xa0;</td>
<td class="right">6:00</td>
</tr>

<tr>
<td class="left">&emsp; Automatic index updating</td>
<td class="left">&#xa0;</td>
<td class="right">5:00</td>
</tr>

<tr>
<td class="left">Code, Testing and Bugs</td>
<td class="left">8:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Tests</td>
<td class="left">&#xa0;</td>
<td class="right">8:00</td>
</tr>

<tr>
<td class="left">Admin</td>
<td class="left">2:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Architecture</td>
<td class="left">&#xa0;</td>
<td class="right">1:00</td>
</tr>

<tr>
<td class="left">&emsp; Documentation</td>
<td class="left">&#xa0;</td>
<td class="right">1:30</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-6-2-3" class="outline-4">
<h4 id="sec-6-2-3">Invoice 3</h4>
<div class="outline-text-4" id="text-6-2-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 5:</span> Clock summary at <span class="timestamp-wrapper"><span class="timestamp">[2019-01-22 mar. 19:40]</span></span></caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Headline</th>
<th scope="col" class="right">Time</th>
<th scope="col" class="right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>Total time</b></td>
<td class="right"><b>1d 16:00</b></td>
<td class="right">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Features</td>
<td class="right">1d 1:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Indexing</td>
<td class="right">&#xa0;</td>
<td class="right">4:00</td>
</tr>

<tr>
<td class="left">&emsp; JSONAPI-compliant Request Format</td>
<td class="right">&#xa0;</td>
<td class="right">7:30</td>
</tr>

<tr>
<td class="left">&emsp; Monitor configuration</td>
<td class="right">&#xa0;</td>
<td class="right">14:00</td>
</tr>

<tr>
<td class="left">Code and Testing</td>
<td class="right">13:30</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Architecture</td>
<td class="right">&#xa0;</td>
<td class="right">1:30</td>
</tr>

<tr>
<td class="left">&emsp; Code Organization</td>
<td class="right">&#xa0;</td>
<td class="right">4:00</td>
</tr>

<tr>
<td class="left">&emsp; Error Handling</td>
<td class="right">&#xa0;</td>
<td class="right">1:30</td>
</tr>

<tr>
<td class="left">&emsp; Testing</td>
<td class="right">&#xa0;</td>
<td class="right">6:30</td>
</tr>

<tr>
<td class="left">Admin</td>
<td class="right">1:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Project management</td>
<td class="right">&#xa0;</td>
<td class="right">0:30</td>
</tr>

<tr>
<td class="left">&emsp; Documentation</td>
<td class="right">&#xa0;</td>
<td class="right">0:30</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-6-2-4" class="outline-4">
<h4 id="sec-6-2-4">Invoice 4</h4>
<div class="outline-text-4" id="text-6-2-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 6:</span> Clock summary at <span class="timestamp-wrapper"><span class="timestamp">[2019-02-07 jeu. 16:15]</span></span></caption>

<colgroup>
<col  class="left" />

<col  class="right" />

<col  class="right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Headline</th>
<th scope="col" class="right">Time</th>
<th scope="col" class="right">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><b>Total time</b></td>
<td class="right"><b>21:00</b></td>
<td class="right">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Features</td>
<td class="right">10:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Indexing</td>
<td class="right">&#xa0;</td>
<td class="right">6:00</td>
</tr>

<tr>
<td class="left">&emsp; Stored indexes</td>
<td class="right">&#xa0;</td>
<td class="right">2:00</td>
</tr>

<tr>
<td class="left">&emsp; Automatic index invalidation</td>
<td class="right">&#xa0;</td>
<td class="right">2:00</td>
</tr>

<tr>
<td class="left">Code and Testing</td>
<td class="right">9:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Architecture</td>
<td class="right">&#xa0;</td>
<td class="right">1:00</td>
</tr>

<tr>
<td class="left">&emsp; Code Organization</td>
<td class="right">&#xa0;</td>
<td class="right">7:00</td>
</tr>

<tr>
<td class="left">&emsp; Testing</td>
<td class="right">&#xa0;</td>
<td class="right">1:00</td>
</tr>

<tr>
<td class="left">Admin</td>
<td class="right">2:00</td>
<td class="right">&#xa0;</td>
</tr>

<tr>
<td class="left">&emsp; Documentation</td>
<td class="right">&#xa0;</td>
<td class="right">2:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: type</p>
<p class="date">Created: 2019-02-13 mer. 18:21</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.2 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
